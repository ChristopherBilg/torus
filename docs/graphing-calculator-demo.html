<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Graphing Calculator demo annotated source</title>
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <main>
        <div class="line">
            <div class="doc">
                <h1>Graphing Calculator demo <span class="fade">annotated source</span></h1>
                <em><a class="back" href="./">Back to index</a></em>
            </div>
            <pre></pre>
        </div>
        <div class="line"><div class="doc"><p>A 2D graphing calculator built with Torus</p>
</div><pre class="source javascript"><strong class="lineNumber">2</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Bootstrap the required globals from Torus, since we&#39;re not bundling</p>
</div><pre class="source javascript"><strong class="lineNumber">4</strong>for (const exportedName in Torus) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">5</strong>    window[exportedName] = Torus[exportedName];</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">6</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">7</strong></pre></div>
<div class="line"><div class="doc"><p>A swatch of colors with enough contrast to be used for graphs and
graph panels in the overlay sidebar.</p>
</div><pre class="source javascript"><strong class="lineNumber">10</strong>const COLORS = [</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">11</strong>    '#e05252',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">12</strong>    '#685ebb',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">13</strong>    '#649c41',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">14</strong>    '#ab589d',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">15</strong>    '#d08b36',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">16</strong>    '#209e9e',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">17</strong>    '#726f84',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">18</strong>    '#58384e',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">19</strong>];</pre></div>
<div class="line"><div class="doc"><p>We select colors by just cycling through the list, starting with the 0th one.</p>
</div><pre class="source javascript"><strong class="lineNumber">21</strong>let colorIdx = -1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">22</strong></pre></div>
<div class="line"><div class="doc"><p>We evaluate user input as functions by transforming them into executable
JavaScript functions with the <code>new Function()</code> constructor. Traditionally,
we&#39;d discourage this because running this with untrusted strings is a security risk.
But since all inputs here are coming directly from the user&#39;s input field, it&#39;s ok.
This allows us to easily support a rich array of mathematical notations,
and here&#39;s a simple substitution list so rather than writing <code>Math.tan(x)</code> in the
input field in the app, which would be weird, we can just write <code>tan(x)</code>.</p>
</div><pre class="source javascript"><strong class="lineNumber">30</strong>const NOTATION_SUBSTITUTES = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">31</strong>    'abs': 'Math.abs',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">32</strong>    'sqrt': 'Math.sqrt',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">33</strong>    'log': 'Math.log',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">34</strong>    'tan': 'Math.tan',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">35</strong>    'sin': 'Math.sin',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">36</strong>    'cos': 'Math.cos',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">37</strong>    '\\^': '**',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">38</strong>    'PI': 'Math.PI',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">39</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">40</strong></pre></div>
<div class="line"><div class="doc"><p>To get the next color from the swatch, just increment the counter
and get the item from the array of colors.</p>
</div><pre class="source javascript"><strong class="lineNumber">43</strong>const randomColor = () =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">44</strong>    colorIdx = (colorIdx + 1) % COLORS.length;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">45</strong>    return COLORS[colorIdx];</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">46</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">47</strong></pre></div>
<div class="line"><div class="doc"><p>&quot;clamp&quot; a given value to the min and max, so that numbers are
bounded by the min/max ranges no matter how big or small, but reflect their
true values within the range. This is necessary because, as an optimization,
modern browsers don&#39;t render lines that are far outside of <code>&lt;canvas&gt;</code> viewports.
But large graphs can explode in range, so rather than asking the browser to render,
say, <code>(2, 300000)</code> and having it ignore the command because it&#39;s outside of the
visible area, we clamp the y-values to the window&#39;s width and height areas
so they&#39;re reasonably close to the visible area and browsers display large values correctly.</p>
</div><pre class="source javascript"><strong class="lineNumber">56</strong>const clamp = (val, min, max) =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">57</strong>    if (val &#62; min) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">58</strong>        return val &#60; max ? val : max;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">59</strong>    } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">60</strong>        return min;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">61</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">62</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">63</strong></pre></div>
<div class="line"><div class="doc"><p>View model that syncs display settings between the graph
controls and the graph itself. This record keeps track of all data about
panning/zooming around the graph, and display settings like <code>resolution</code> and whether
we try to detect and auto-fix vertical asymptotes.</p>
</div><pre class="source javascript"><strong class="lineNumber">68</strong>class GraphPropsRecord extends Record {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">69</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">70</strong>    constructor() {</pre></div>
<div class="line"><div class="doc"><p><code>GraphPropsRecord</code> has centerX, centerY, and zoom properties.
centerX and Y and coordinate values, and zoom
is pixels per unit (i.e. if 20, 20 pixels on canvas
corresponds to one unit in the graph.) We initialize this record
with some default values.</p>
</div><pre class="source javascript"><strong class="lineNumber">76</strong>        super({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">77</strong>            centerX: 0,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">78</strong>            centerY: 0,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">79</strong>            zoom: 100,</pre></div>
<div class="line"><div class="doc"><p>The units for this is &quot;pixels per sample&quot;. i.e. If it&#39;s 5,
we&#39;ll compute a new value every 5 pixels on the x-axis
and connect the dots.</p>
</div><pre class="source javascript"><strong class="lineNumber">83</strong>            resolution: 5,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>If this is set to true, we can try to detect large swings across
the y = 0 line and not draw those lines.</p>
</div><pre class="source javascript"><strong class="lineNumber">86</strong>            detectAsymptotes: false,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">87</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">88</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">89</strong></pre></div>
<div class="line"><div class="doc"><p>We override the behavior of <code>Record#update()</code> so we enforce an upper limit
of zoom level. Otherwise, graphs start to break meaninglessly.</p>
</div><pre class="source javascript"><strong class="lineNumber">92</strong>    update(dict) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">93</strong>        if (dict.zoom !== undefined) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">94</strong>            dict.zoom = dict.zoom &#60; 10 ? 10 : dict.zoom;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">95</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">96</strong>        super.update(dict);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">97</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">98</strong></pre></div>
<div class="line"><div class="doc"><p>In &quot;high performance&quot; mode, we render a y-value for every single pixel along
the width of the screen. On slower devices this <em>might</em> be an issue with many
functions, though I haven&#39;t found any issues yet. This toggles whether we do that,
or just render every 5 pixels like normal.</p>
</div><pre class="source javascript"><strong class="lineNumber">103</strong>    toggleHighPerf() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">104</strong>        this.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">105</strong>            resolution: this.get('resolution') === 5 ? 1 : 5,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">106</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">107</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">108</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">109</strong>    toggleDetectAsymptotes() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">110</strong>        this.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">111</strong>            detectAsymptotes: !this.get('detectAsymptotes'),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">112</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">113</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">114</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">115</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">116</strong></pre></div>
<div class="line"><div class="doc"><p>This represents a single function the user defines, to be drawn
in the graph region.</p>
</div><pre class="source javascript"><strong class="lineNumber">119</strong>class FunctionRecord extends Record {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">120</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">121</strong>    constructor(...args) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">122</strong>        super(...args);</pre></div>
<div class="line"><div class="doc"><p>By default, functions have a random color, are not hidden, and are not invalid.</p>
</div><pre class="source javascript"><strong class="lineNumber">124</strong>        this.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">125</strong>            color: randomColor(),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">126</strong>            hidden: false,</pre></div>
<div class="line"><div class="doc"><p><code>invalid</code> means the user input was not a valid, computable function.</p>
</div><pre class="source javascript"><strong class="lineNumber">128</strong>            invalid: false,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">129</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">130</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">131</strong></pre></div>
<div class="line"><div class="doc"><p>We override this so we can inject two extra values: <code>jsFunction</code>, which is a runnable
JavaScript function object that does <code>f(x) -&gt; y</code> computation, and <code>invalid</code>, which is explained above.</p>
</div><pre class="source javascript"><strong class="lineNumber">134</strong>    summarize() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">135</strong>        let invalid = false;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">136</strong>        let fn = () =&#62; 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">137</strong>        let substitutedText = this.get('text');</pre></div>
<div class="line"><div class="doc"><p>We make the substitutions for things like <code>sin(x) -&gt; Math.sin(x)</code> so the JavaScript
engine can run it like normal JS functions.</p>
</div><pre class="source javascript"><strong class="lineNumber">140</strong>        for (const [regex, sub] of Object.entries(NOTATION_SUBSTITUTES)) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">141</strong>            substitutedText = substitutedText.replace(new RegExp(regex, 'g'), sub);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">142</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">143</strong>        try {</pre></div>
<div class="line"><div class="doc"><p>We try to construct a function that computes the given operation, as a
JavaScript function object.</p>
</div><pre class="source javascript"><strong class="lineNumber">146</strong>            fn = new Function('x', 'return ' + substitutedText);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">147</strong>        } catch (e) {</pre></div>
<div class="line"><div class="doc"><p>If it fails, the user input is invalid.</p>
</div><pre class="source javascript"><strong class="lineNumber">149</strong>            invalid = true;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">150</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">151</strong>        return Object.assign(</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">152</strong>            super.summarize(),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">153</strong>            {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">154</strong>                jsFunction: fn,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">155</strong>                invalid: invalid,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">156</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">157</strong>        );</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">158</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">159</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">160</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">161</strong></pre></div>
<div class="line"><div class="doc"><p>This represents a collection of functions, i.e. the list in the overlay panel
we see in the UI.</p>
</div><pre class="source javascript"><strong class="lineNumber">164</strong>class FunctionStore extends StoreOf(FunctionRecord) {}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">165</strong></pre></div>
<div class="line"><div class="doc"><p>The <code>AppBar</code> is the overlay panel that contains all UI about functions and graph controls.</p>
</div><pre class="source javascript"><strong class="lineNumber">167</strong>class AppBar extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">168</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">169</strong>    init(functionStore, graphProps) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">170</strong>        this.functionStore = functionStore;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">171</strong>        this.graphProps = graphProps;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">172</strong></pre></div>
<div class="line"><div class="doc"><p>We create a new list view to hold panels of function controls.</p>
</div><pre class="source javascript"><strong class="lineNumber">174</strong>        this.functionList = new FunctionList(this.functionStore, functionStore);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">175</strong></pre></div>
<div class="line"><div class="doc"><p>There are a bunch of methods here that we need to bind, so we can call them
as event listeners in our render step.</p>
</div><pre class="source javascript"><strong class="lineNumber">178</strong>        this.addFunction = this.addFunction.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">179</strong>        this.resetGraphProps = this.resetGraphProps.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">180</strong>        this.moveUp = this.moveUp.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">181</strong>        this.moveDown = this.moveDown.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">182</strong>        this.moveLeft = this.moveLeft.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">183</strong>        this.moveRight = this.moveRight.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">184</strong>        this.zoomIn = this.zoomIn.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">185</strong>        this.zoomOut = this.zoomOut.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">186</strong>        this.toggleHighPerfMode = this.toggleHighPerfMode.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">187</strong>        this.toggleDetectAsymptotes = this.toggleDetectAsymptotes.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">188</strong></pre></div>
<div class="line"><div class="doc"><p>We want to reference graphProps with <code>this.records</code>, but
when props on it updates, we don&#39;t really need to re-render.
So we don&#39;t, for performance reasons.</p>
</div><pre class="source javascript"><strong class="lineNumber">192</strong>        this.bind(graphProps, () =&#62; {});</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">193</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">194</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">195</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">196</strong>        const CONTROL_SIZE = 34;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">197</strong>        const CONTROL_MARGIN = 4;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">198</strong>        return {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">199</strong>            'position': 'fixed',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">200</strong>            'top': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">201</strong>            'left': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">202</strong>            'width': '320px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">203</strong>            'display': 'flex',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">204</strong>            'flex-direction': 'column',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">205</strong>            'justify-content': 'flex-start',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">206</strong>            'align-items': 'center',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">207</strong>            'max-height': 'calc(100vh - 18px)',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">208</strong>            'overflow-y': 'auto',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">209</strong>            'padding': '18px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">210</strong>            'body.graph_dragging &#38;': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">211</strong>                'pointer-events': 'none',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">212</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">213</strong>            '.graphSettings': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">214</strong>                'padding': '8px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">215</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">216</strong>            'label': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">217</strong>                'font-size': '14px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">218</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">219</strong>            '.title': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">220</strong>                'font-weight': 'bold',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">221</strong>                'font-size': '20px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">222</strong>                'margin-bottom': '12px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">223</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">224</strong>            '.inputGroup': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">225</strong>                'margin-top': '12px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">226</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">227</strong>            '.controlGroup': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">228</strong>                'display': 'flex',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">229</strong>                'flex-direction': 'row',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">230</strong>                'justify-content': 'space-around',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">231</strong>                'align-items': 'center',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">232</strong>                'height': (CONTROL_SIZE * 3) + (CONTROL_MARGIN * 2) + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">233</strong>                'button': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">234</strong>                    'background': '#fff',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">235</strong>                    'border-radius': '6px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">236</strong>                    'border': '2px solid #aaa',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">237</strong>                    'font-size': '18px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">238</strong>                    'text-align': 'center',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">239</strong>                    'box-sizing': 'border-box',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">240</strong>                    'height': CONTROL_SIZE + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">241</strong>                    'width': CONTROL_SIZE + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">242</strong>                    'padding': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">243</strong>                    'cursor': 'pointer',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">244</strong>                    'transition': 'transform .2s',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">245</strong>                    '&#38;:hover': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">246</strong>                        'transform': 'scale(1.1)',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">247</strong>                    },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">248</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">249</strong>            },</pre></div>
<div class="line"><div class="doc"><p>In the <code>.panGroup</code> container, we try to arrange the panning
buttons (for moving around the graph) in a cross shape
using absolute position coordinates.</p>
</div><pre class="source javascript"><strong class="lineNumber">253</strong>            '.panGroup': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">254</strong>                'height': (CONTROL_SIZE * 3) + (CONTROL_MARGIN * 2) + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">255</strong>                'width': (CONTROL_SIZE * 3) + (CONTROL_MARGIN * 2) + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">256</strong>                'position': 'relative',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">257</strong>                'button': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">258</strong>                    'position': 'absolute',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">259</strong>                    'display': 'block',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">260</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">261</strong>                '.moveUpButton': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">262</strong>                    'top': 0,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">263</strong>                    'left': CONTROL_SIZE + CONTROL_MARGIN + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">264</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">265</strong>                '.moveDownButton': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">266</strong>                    'top': (CONTROL_SIZE * 2) + (CONTROL_MARGIN * 2) + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">267</strong>                    'left': CONTROL_SIZE + CONTROL_MARGIN + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">268</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">269</strong>                '.moveRightButton': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">270</strong>                    'top': CONTROL_SIZE + CONTROL_MARGIN + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">271</strong>                    'left': (CONTROL_SIZE * 2) + (CONTROL_MARGIN * 2) + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">272</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">273</strong>                '.moveLeftButton': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">274</strong>                    'top': CONTROL_SIZE + CONTROL_MARGIN + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">275</strong>                    'left': '0px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">276</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">277</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">278</strong>            '.zoomGroup': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">279</strong>                'display': 'flex',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">280</strong>                'flex-direction': 'column',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">281</strong>                'align-items': 'center',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">282</strong>                'justify-content': 'space-between',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">283</strong>                'height': '100%',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">284</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">285</strong>            '.resetGroup': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">286</strong>                'button': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">287</strong>                    'font-size': '14px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">288</strong>                    'width': '60px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">289</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">290</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">291</strong>            '.toggleInput': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">292</strong>                'margin-right': '8px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">293</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">294</strong>            '.panel': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">295</strong>                'flex-shrink': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">296</strong>                'width': '100%',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">297</strong>                'margin-bottom': '18px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">298</strong>                'border-radius': '8px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">299</strong>                'overflow': 'hidden',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">300</strong>                'box-shadow': '0 2px 8px -1px rgba(0, 0, 0, .3)',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">301</strong>                'min-height': '36px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">302</strong>                'box-sizing': 'border-box',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">303</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">304</strong>            '.newFunctionPanel, .graphSettings': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">305</strong>                'background': '#fff',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">306</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">307</strong>            '.newFunctionPanel': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">308</strong>                'transition': 'transform .2s',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">309</strong>                'button': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">310</strong>                    'height': '100%',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">311</strong>                    'width': '100%',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">312</strong>                    'font-size': '16px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">313</strong>                    'line-height': '36px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">314</strong>                    'text-align': 'left',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">315</strong>                    'border': 0,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">316</strong>                    'cursor': 'pointer',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">317</strong>                    'background': 'transparent',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">318</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">319</strong>                '&#38;:hover': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">320</strong>                    'background': '#f8f8f8',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">321</strong>                    'transform': 'translateY(2px)',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">322</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">323</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">324</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">325</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">326</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">327</strong>    addFunction() {</pre></div>
<div class="line"><div class="doc"><p>By default, we create the function <em>f(x) = x</em>.</p>
</div><pre class="source javascript"><strong class="lineNumber">329</strong>        this.functionStore.create({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">330</strong>            text: 'x',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">331</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">332</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">333</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">334</strong>    resetGraphProps() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">335</strong>        this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">336</strong>            centerX: 0,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">337</strong>            centerY: 0,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">338</strong>            zoom: 100,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">339</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">340</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">341</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">342</strong>    moveUp() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">343</strong>        this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">344</strong>            centerY: this.record.get('centerY') + (100 / this.record.get('zoom')),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">345</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">346</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">347</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">348</strong>    moveDown() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">349</strong>        this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">350</strong>            centerY: this.record.get('centerY') - (100 / this.record.get('zoom')),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">351</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">352</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">353</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">354</strong>    moveLeft() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">355</strong>        this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">356</strong>            centerX: this.record.get('centerX') - (100 / this.record.get('zoom')),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">357</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">358</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">359</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">360</strong>    moveRight() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">361</strong>        this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">362</strong>            centerX: this.record.get('centerX') + (100 / this.record.get('zoom')),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">363</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">364</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">365</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">366</strong>    zoomIn() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">367</strong>        this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">368</strong>            zoom: this.record.get('zoom') * 1.2,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">369</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">370</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">371</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">372</strong>    zoomOut() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">373</strong>        this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">374</strong>            zoom: this.record.get('zoom') / 1.2,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">375</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">376</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">377</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">378</strong>    toggleHighPerfMode() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">379</strong>        this.record.toggleHighPerf();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">380</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">381</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">382</strong>    toggleDetectAsymptotes() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">383</strong>        this.record.toggleDetectAsymptotes();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">384</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">385</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">386</strong>    compose() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">387</strong>        return jdom`&#60;div class="appBar"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">388</strong>            &#60;div class="panel graphSettings"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">389</strong>                &#60;div class="title"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">390</strong>                    Graphing Calculator 📈</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">391</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">392</strong>                &#60;div class="inputGroup controlGroup"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">393</strong>                    &#60;div class="panGroup"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">394</strong>                        &#60;button class="moveUpButton" onclick="${this.moveUp}"&#62;☝️&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">395</strong>                        &#60;button class="moveDownButton" onclick="${this.moveDown}"&#62;👇&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">396</strong>                        &#60;button class="moveLeftButton" onclick="${this.moveLeft}"&#62;👈&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">397</strong>                        &#60;button class="moveRightButton" onclick="${this.moveRight}"&#62;👉&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">398</strong>                    &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">399</strong>                    &#60;div class="resetGroup"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">400</strong>                        &#60;button class="resetButton" onclick="${this.resetGraphProps}"&#62;Reset&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">401</strong>                    &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">402</strong>                    &#60;div class="zoomGroup"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">403</strong>                        &#60;button class="zoomInButton" onclick="${this.zoomIn}"&#62;🔍&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">404</strong>                        &#60;button class="zoomOutButton" onclick="${this.zoomOut}"&#62;🔭&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">405</strong>                    &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">406</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">407</strong>                &#60;div class="inputGroup"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">408</strong>                    &#60;input class="toggleInput" id="higherPerfCheck" type="checkbox" onchange="${this.toggleHighPerfMode}" /&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">409</strong>                    &#60;label for="higherPerfCheck"&#62;More accurate graphs (might be slower)&#60;/label&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">410</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">411</strong>                &#60;div class="inputGroup"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">412</strong>                    &#60;input class="toggleInput" id="detectAsymptotes" type="checkbox" onchange="${this.toggleDetectAsymptotes}" /&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">413</strong>                    &#60;label for="detectAsymptotes"&#62;Try to detect &#38;#38; fix vertical asymptotes&#60;/label&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">414</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">415</strong>            &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">416</strong>            ${this.functionList.node}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">417</strong>            &#60;div class="panel newFunctionPanel"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">418</strong>                &#60;button class="newFunctionButton" onclick="${this.addFunction}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">419</strong>                    + Add another function</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">420</strong>                &#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">421</strong>            &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">422</strong>        &#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">423</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">424</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">425</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">426</strong></pre></div>
<div class="line"><div class="doc"><p>This represents a single function list item in the overlay sidebar</p>
</div><pre class="source javascript"><strong class="lineNumber">428</strong>class FunctionPanel extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">429</strong></pre></div>
<div class="line"><div class="doc"><p>Since this is a <code>List</code> item, it&#39;s given two arguments, the first
the record for this component, and the second a callback to remove
the item from the list. We&#39;ll store the latter as a property.</p>
</div><pre class="source javascript"><strong class="lineNumber">433</strong>    init(functionRecord, removeCallback, functionStore) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">434</strong>        this.removeCallback = removeCallback;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">435</strong>        this.functionStore = functionStore;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">436</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">437</strong>        this.keyUp = this.keyUp.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">438</strong>        this.updateFunctionText = this.updateFunctionText.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">439</strong>        this.toggleHidden = this.toggleHidden.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">440</strong>        this.duplicate = this.duplicate.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">441</strong>        this.updateColor = this.updateColor.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">442</strong></pre></div>
<div class="line"><div class="doc"><p>We want to re-render this component every time something about
the function changes.</p>
</div><pre class="source javascript"><strong class="lineNumber">445</strong>        this.bind(functionRecord, props =&#62; this.render(props));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">446</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">447</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">448</strong>    styles(props) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">449</strong>        const HEIGHT = 72;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">450</strong>        return {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">451</strong>            'height': HEIGHT + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">452</strong>            'background': props.color,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">453</strong>            '&#38;.hidden': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">454</strong>                'opacity': '.45',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">455</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">456</strong>            '.caps': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">457</strong>                'text-transform': 'uppercase',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">458</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">459</strong>            '.inputArea, .buttonArea': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">460</strong>                'height': '50%',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">461</strong>                'display': 'flex',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">462</strong>                'flex-direction': 'row',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">463</strong>                'align-items': 'center',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">464</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">465</strong>            '.inputArea': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">466</strong>                'justify-content': 'space-between',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">467</strong>                '.yPrefix, input': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">468</strong>                    'display': 'block',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">469</strong>                    'height': '100%',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">470</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">471</strong>                '.yPrefix': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">472</strong>                    'background': 'rgba(255, 255, 255, 0.4)',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">473</strong>                    'width': '40px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">474</strong>                    'text-align': 'center',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">475</strong>                    'line-height': (HEIGHT / 2) + 'px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">476</strong>                    'color': '#fff',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">477</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">478</strong>                'input': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">479</strong>                    'flex-grow': '1',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">480</strong>                    'margin': 0,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">481</strong>                    'border-radius': 0,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">482</strong>                    'box-sizing': 'border-box',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">483</strong>                    'padding': '4px 6px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">484</strong>                    'font-size': '16px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">485</strong>                    'border': 0,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">486</strong>                    '&#38;:focus': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">487</strong>                        'background': 'rgba(255, 255, 255, .9)',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">488</strong>                        'outline': 'none',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">489</strong>                    },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">490</strong>                    '&#38;::placeholder': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">491</strong>                        'color': '#aaa',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">492</strong>                    },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">493</strong>                    '&#38;.invalid': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">494</strong>                        'box-shadow': 'inset 0 0 0 3px rgba(208, 83, 55, 0.6)',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">495</strong>                        'background': '#eccfcf',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">496</strong>                    },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">497</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">498</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">499</strong>            '.buttonArea': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">500</strong>                'justify-content': 'flex-end',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">501</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">502</strong>            'button': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">503</strong>                'margin-right': '6px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">504</strong>                'color': '#fff',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">505</strong>                'height': '24px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">506</strong>                'line-height': '22px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">507</strong>                'background-color': 'rgba(255, 255, 255, 0.4)',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">508</strong>                'font-size': '14px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">509</strong>                'border-radius': '4px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">510</strong>                'border': 0,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">511</strong>                'cursor': 'pointer',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">512</strong>                '&#38;:hover': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">513</strong>                    'background': '#fff',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">514</strong>                    'color': props.color,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">515</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">516</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">517</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">518</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">519</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">520</strong>    keyUp(evt) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">521</strong>        if (evt &#38;&#38; evt.key === 'Enter') {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">522</strong>            this.updateFunctionText();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">523</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">524</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">525</strong></pre></div>
<div class="line"><div class="doc"><p>This component is not a controlled component, because it doesn&#39;t need to be,
and for sake of performance. So when we do need to update the value of the function,
we grab the input from the text field manually, and update the record.</p>
</div><pre class="source javascript"><strong class="lineNumber">529</strong>    updateFunctionText() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">530</strong>        const text = this.node.querySelector('input').value;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">531</strong>        this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">532</strong>            text: text,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">533</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">534</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">535</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">536</strong>    toggleHidden() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">537</strong>        this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">538</strong>            hidden: !this.record.get('hidden'),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">539</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">540</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">541</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">542</strong>    duplicate() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">543</strong>        this.functionStore.create({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">544</strong>            text: this.record.get('text'),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">545</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">546</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">547</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">548</strong>    updateColor() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">549</strong>        this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">550</strong>            color: randomColor(),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">551</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">552</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">553</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">554</strong>    compose(props) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">555</strong>        return jdom`&#60;div class="panel functionPanel ${props.hidden ? 'hidden' : ''}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">556</strong>            &#60;div class="inputArea"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">557</strong>                &#60;div class="yPrefix"&#62;y =&#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">558</strong>                &#60;input type="text" value="${props.text}" onblur="${this.updateFunctionText}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">559</strong>                    onkeyup="${this.keyUp}" placeholder="log(), sqrt(), abs(), trig supported"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">560</strong>                    class="${props.invalid ? 'invalid' : ''}" /&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">561</strong>            &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">562</strong>            &#60;div class="buttonArea"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">563</strong>                &#60;button onclick="${this.removeCallback}"&#62;Delete&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">564</strong>                &#60;button onclick="${this.toggleHidden}"&#62;${props.hidden ? '🙈 Show' : '👀 Hide'}&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">565</strong>                &#60;button onclick="${this.duplicate}"&#62;Duplicate&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">566</strong>                &#60;button onclick="${this.updateColor}"&#62;🎨 Color&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">567</strong>            &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">568</strong>        &#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">569</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">570</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">571</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">572</strong></pre></div>
<div class="line"><div class="doc"><p>List class that wraps around a collection (Store) of functions.
We override this so rather than using <code>&lt;ul&gt;</code>s we use <code>&lt;div&gt;</code>s.</p>
</div><pre class="source javascript"><strong class="lineNumber">575</strong>class FunctionList extends Styled(ListOf(FunctionPanel)) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">576</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">577</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">578</strong>        return {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">579</strong>            'width': '100%',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">580</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">581</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">582</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">583</strong>    compose() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">584</strong>        return jdom`&#60;div&#62;${this.nodes}&#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">585</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">586</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">587</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">588</strong></pre></div>
<div class="line"><div class="doc"><p>This component represents a single graph -- just the curve connecting the y-values.
These are then collected into a <code>GraphCollection</code> component,
which is a <code>List</code> that contains multiple canvas elements, one for each
function graph. Because canvases are transparent, we can just stack
<code>FunctionGraph</code>s on top of each other to render the whole, final graph.</p>
</div><pre class="source javascript"><strong class="lineNumber">594</strong>class FunctionGraph extends Component {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">595</strong></pre></div>
<div class="line"><div class="doc"><p>In addition to the normal arguments, we also get passed down
the graph configs, so we can render the function graphs properly.</p>
</div><pre class="source javascript"><strong class="lineNumber">598</strong>    init(functionRecord, _removeCallback, graphProps) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">599</strong>        this.graphProps = graphProps;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">600</strong></pre></div>
<div class="line"><div class="doc"><p>Create a new canvas for this graph and get the 2D drawing context.</p>
</div><pre class="source javascript"><strong class="lineNumber">602</strong>        this.canvas = document.createElement('canvas');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">603</strong>        this.context = this.canvas.getContext('2d');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">604</strong></pre></div>
<div class="line"><div class="doc"><p>We want to re-draw just this function on the canvas
when anything about the function changes.</p>
</div><pre class="source javascript"><strong class="lineNumber">607</strong>        this.bind(functionRecord, () =&#62; this.redraw());</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">608</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">609</strong></pre></div>
<div class="line"><div class="doc"><p>Method to wipe and re-draw the function&#39;s graph
on the canvas.</p>
</div><pre class="source javascript"><strong class="lineNumber">612</strong>    redraw() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Shorthand so I don&#39;t have to keep typing <code>this.context</code></p>
</div><pre class="source javascript"><strong class="lineNumber">614</strong>        const ctx = this.context;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">615</strong></pre></div>
<div class="line"><div class="doc"><p>We get the window&#39;s height and width and make sure our canvas
is sized to fit.</p>
</div><pre class="source javascript"><strong class="lineNumber">618</strong>        const width = this.canvas.width = window.innerWidth;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">619</strong>        const height = this.canvas.height = window.innerHeight;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">620</strong></pre></div>
<div class="line"><div class="doc"><p>Clear canvas</p>
</div><pre class="source javascript"><strong class="lineNumber">622</strong>        ctx.clearRect(0, 0, width, height);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">623</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">624</strong>        const functionSummary = this.record.summarize();</pre></div>
<div class="line"><div class="doc"><p>If the function is hidden, we don&#39;t need to do anything after
clearing the canvas.</p>
</div><pre class="source javascript"><strong class="lineNumber">627</strong>        if (functionSummary.hidden) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">628</strong>            return;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">629</strong>        } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">630</strong>            const graphPropsSummary = this.graphProps.summarize();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">631</strong></pre></div>
<div class="line"><div class="doc"><p>Destructure properties from graphProps</p>
</div><pre class="source javascript"><strong class="lineNumber">633</strong>            const {centerX, centerY, zoom, resolution, detectAsymptotes} = graphPropsSummary;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">634</strong>            const centerXScreen = width / 2;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">635</strong>            const centerYScreen = height / 2;</pre></div>
<div class="line"><div class="doc"><p>These values represent min/max values <em>on the graph</em>, and help us
determine which x- and y-values we need to worry about computing.</p>
</div><pre class="source javascript"><strong class="lineNumber">638</strong>            const minX = ~~(centerX - (centerXScreen / zoom)) - 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">639</strong>            const maxX = ~~(centerX + (centerXScreen / zoom)) + 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">640</strong>            const minY = ~~(centerY - (centerYScreen / zoom)) - 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">641</strong>            const maxY = ~~(centerY + (centerYScreen / zoom)) + 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">642</strong></pre></div>
<div class="line"><div class="doc"><p>Pair of short functions that map x/y values to their
position on the canvas.</p>
</div><pre class="source javascript"><strong class="lineNumber">645</strong>            const xToCoord = xValue =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">646</strong>                return centerXScreen + ((xValue - centerX) * zoom);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">647</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">648</strong>            const yToCoord = yValue =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">649</strong>                return centerYScreen - ((yValue - centerY) * zoom);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">650</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">651</strong></pre></div>
<div class="line"><div class="doc"><p>This is the function we need to run on each x-value.</p>
</div><pre class="source javascript"><strong class="lineNumber">653</strong>            const f = functionSummary.jsFunction;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">654</strong></pre></div>
<div class="line"><div class="doc"><p>Re-draw this function</p>
</div><pre class="source javascript"><strong class="lineNumber">656</strong>            ctx.lineWidth = 3;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>We want to draw the function graph with the function&#39;s color</p>
</div><pre class="source javascript"><strong class="lineNumber">658</strong>            ctx.strokeStyle = functionSummary.color;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">659</strong>            ctx.beginPath();</pre></div>
<div class="line"><div class="doc"><p>We keep track of the last y value computed, to do potential
asymptote detection</p>
</div><pre class="source javascript"><strong class="lineNumber">662</strong>            let lastY = 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">663</strong>            const increment = resolution / zoom;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">664</strong>            for (let x = minX; x &#60; maxX; x += increment) {</pre></div>
<div class="line"><div class="doc"><p>Try to get a non-asymptotic value of y</p>
</div><pre class="source javascript"><strong class="lineNumber">666</strong>                const y = f(x);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Graph it.</p>
</div><pre class="source javascript"><strong class="lineNumber">668</strong>                if (!isNaN(y)) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>There&#39;s some complexity here to avoid drawing an incorrect line
through the middle of the screen when asymptotic limits switch signs.
Essentially, we consider an asymptote any short increment in X that
results in a y value that jumps across the y = 0 line, and from
the bottom of the screen to the top of the screen (<code>&gt; height</code>).</p>
</div><pre class="source javascript"><strong class="lineNumber">674</strong>                    const diff = y - lastY;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">675</strong>                    const diffSign = y * lastY &#60; 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">676</strong>                    lastY = y;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">677</strong>                    if (detectAsymptotes &#38;&#38; Math.abs(diff * zoom) &#62; height &#38;&#38; diffSign) {</pre></div>
<div class="line"><div class="doc"><p>If there is an asymptote as we&#39;ve defined it, don&#39;t connect from
the previous point; just go to a new point.</p>
</div><pre class="source javascript"><strong class="lineNumber">680</strong>                        ctx.moveTo(xToCoord(x), yToCoord(clamp(y, minY, maxY)));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">681</strong>                    } else {</pre></div>
<div class="line"><div class="doc"><p>Otherwise, connect the line from the previous point.</p>
</div><pre class="source javascript"><strong class="lineNumber">683</strong>                        ctx.lineTo(xToCoord(x), yToCoord(clamp(y, minY, maxY)));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">684</strong>                    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">685</strong>                }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">686</strong>            }</pre></div>
<div class="line"><div class="doc"><p>Commit the curve we&#39;ve just defined to the canvas.</p>
</div><pre class="source javascript"><strong class="lineNumber">688</strong>            ctx.stroke();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">689</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">690</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">691</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">692</strong></pre></div>
<div class="line"><div class="doc"><p>When we render this component, we just render the canvas element we
keep drawing to.</p>
</div><pre class="source javascript"><strong class="lineNumber">695</strong>    compose() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">696</strong>        return this.canvas;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">697</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">698</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">699</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">700</strong></pre></div>
<div class="line"><div class="doc"><p><code>&lt;ul&gt;</code> of all the functions&#39; canvases.</p>
</div><pre class="source javascript"><strong class="lineNumber">702</strong>const GraphCollection = ListOf(FunctionGraph);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">703</strong></pre></div>
<div class="line"><div class="doc"><p>The <code>Graph</code> component holds the graph grid, and manages the rest of the
functions&#39; graphs in a <code>GraphCollection</code> under it.</p>
</div><pre class="source javascript"><strong class="lineNumber">706</strong>class Graph extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">707</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">708</strong>    init(functionStore, graphProps) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">709</strong>        this.functionStore = functionStore;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">710</strong>        this.graphProps = graphProps;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">711</strong></pre></div>
<div class="line"><div class="doc"><p>Create a canvas for the grid, and get the 2D drawing context.</p>
</div><pre class="source javascript"><strong class="lineNumber">713</strong>        this.canvas = document.createElement('canvas');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">714</strong>        this.context = this.canvas.getContext('2d');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">715</strong></pre></div>
<div class="line"><div class="doc"><p>Given a collection of functions, create a list of views that
each render their function to their own canvas.</p>
</div><pre class="source javascript"><strong class="lineNumber">718</strong>        this.functionGraphs = new GraphCollection(functionStore, this.graphProps);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">719</strong></pre></div>
<div class="line"><div class="doc"><p>We bind <code>redraw</code> a bit differently than normal here because we want to be
efficient about when we re-render the entire graph from scratch. We really
only ever need to do it once per frame, before the frame is painted. So
we use <code>requestAnimationFrame()</code>.</p>
</div><pre class="source javascript"><strong class="lineNumber">724</strong>        const boundReDraw = this.redraw.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">725</strong>        this.redraw = () =&#62; requestAnimationFrame(boundReDraw);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">726</strong>        this.handleWheel = this.handleWheel.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">727</strong>        this.handleMousedown = this.handleMousedown.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">728</strong>        this.handleMouseup = this.handleMouseup.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">729</strong>        this.handleMousemove = this.handleMousemove.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">730</strong>        this.handleTouchstart = this.handleTouchstart.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">731</strong>        this.handleTouchend = this.handleTouchend.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">732</strong>        this.handleTouchmove = this.handleTouchmove.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">733</strong></pre></div>
<div class="line"><div class="doc"><p>When the window is resized, we want to re-draw the graph to fit.</p>
</div><pre class="source javascript"><strong class="lineNumber">735</strong>        window.addEventListener('resize', this.redraw);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>When anything about the graph settings are updated, we want to re-draw.</p>
</div><pre class="source javascript"><strong class="lineNumber">737</strong>        this.bind(this.graphProps, this.redraw);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">738</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">739</strong></pre></div>
<div class="line"><div class="doc"><p>Make sure to remove the event listener we bound earlier, if we ever remove this component.</p>
</div><pre class="source javascript"><strong class="lineNumber">741</strong>    remove() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">742</strong>        window.removeEventListener('resize', this.redraw);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">743</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">744</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">745</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">746</strong>        return {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">747</strong>            'position': 'fixed',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">748</strong>            'z-index': '-1',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">749</strong>            'top': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">750</strong>            'left': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">751</strong>            'right': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">752</strong>            'bottom': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">753</strong>            'cursor': 'grab',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">754</strong>            '&#38;:active': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">755</strong>                'cursor': 'grabbing',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">756</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">757</strong>            'canvas': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">758</strong>                'position': 'absolute',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">759</strong>                'top': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">760</strong>                'left': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">761</strong>                'right': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">762</strong>                'bottom': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">763</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">764</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">765</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">766</strong></pre></div>
<div class="line"><div class="doc"><p>When the mouse scroll wheel scrolls on the page,
we want to zoom in or out depending on the scroll direction.
We also throttle this with <code>requestAnimationFrame</code> to be
efficient about how much we re-render the graph, and when.</p>
</div><pre class="source javascript"><strong class="lineNumber">771</strong>    handleWheel(evt) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Prevent overscroll spring behavior on macOS</p>
</div><pre class="source javascript"><strong class="lineNumber">773</strong>        evt.preventDefault();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">774</strong>        const change = evt.deltaY;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">775</strong>        const scaledChange = Math.max(change / 1000, -.3);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">776</strong>        requestAnimationFrame(() =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">777</strong>            this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">778</strong>                zoom: this.record.get('zoom') * (1 + scaledChange),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">779</strong>            });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">780</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">781</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">782</strong></pre></div>
<div class="line"><div class="doc"><p>The next three functions are a standard drag-and-drop implementation
for mouse events. We mark the starting position when we start dragging...</p>
</div><pre class="source javascript"><strong class="lineNumber">785</strong>    handleMousedown(evt) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">786</strong>        this._dragging = true;</pre></div>
<div class="line"><div class="doc"><p>When we set this flag, the overlay sidebar becomes
invisible to pointer events, so the graph receives all the mouse
actions and the sidebar can&#39;t block it all of a sudden.</p>
</div><pre class="source javascript"><strong class="lineNumber">790</strong>        document.body.classList.add('graph_dragging');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">791</strong>        this._lastClientX = evt.clientX;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">792</strong>        this._lastClientY = evt.clientY;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">793</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">794</strong></pre></div>
<div class="line"><div class="doc"><p>... and set the flag to false when we stop ...</p>
</div><pre class="source javascript"><strong class="lineNumber">796</strong>    handleMouseup() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">797</strong>        this._dragging = false;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">798</strong>        document.body.classList.remove('graph_dragging');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">799</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">800</strong></pre></div>
<div class="line"><div class="doc"><p>... and in between, anytime there&#39;s mouse movement over the graph,
we compute how much distance changed between the initial click down
and now, and pan the graph by that amount, again throttled by
<code>requestAnimationFrame()</code> to be efficient about when we redraw.</p>
</div><pre class="source javascript"><strong class="lineNumber">805</strong>    handleMousemove(evt) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">806</strong>        evt.preventDefault();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">807</strong>        if (this._dragging) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">808</strong>            const clientX = evt.clientX;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">809</strong>            const clientY = evt.clientY;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">810</strong>            const deltaX = clientX - this._lastClientX;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">811</strong>            const deltaY = clientY - this._lastClientY;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">812</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">813</strong>            requestAnimationFrame(() =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">814</strong>                const props = this.record.summarize();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">815</strong>                this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">816</strong>                    centerX: props.centerX - (deltaX / props.zoom),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">817</strong>                    centerY: props.centerY + (deltaY / props.zoom),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">818</strong>                });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">819</strong>            });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">820</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">821</strong>            this._lastClientX = clientX;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">822</strong>            this._lastClientY = clientY;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">823</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">824</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">825</strong></pre></div>
<div class="line"><div class="doc"><p>The next three functions are the same as the drag-and-drop code above,
but for touch events on things like Windows laptops and iPad.</p>
</div><pre class="source javascript"><strong class="lineNumber">828</strong>    handleTouchstart(evt) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">829</strong>        this._touchDragging = true;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">830</strong>        document.body.classList.add('graph_dragging');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">831</strong>        this._lastClientX = evt.touches[0].clientX;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">832</strong>        this._lastClientY = evt.touches[0].clientY;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">833</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">834</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">835</strong>    handleTouchend() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">836</strong>        this._touchDragging = false;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">837</strong>        document.body.classList.remove('graph_dragging');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">838</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">839</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">840</strong>    handleTouchmove(evt) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">841</strong>        evt.preventDefault();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">842</strong>        if (this._touchDragging) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">843</strong>            const clientX = evt.touches[0].clientX;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">844</strong>            const clientY = evt.touches[0].clientY;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">845</strong>            const deltaX = clientX - this._lastClientX;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">846</strong>            const deltaY = clientY - this._lastClientY;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">847</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">848</strong>            requestAnimationFrame(() =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">849</strong>                const props = this.record.summarize();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">850</strong>                this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">851</strong>                    centerX: props.centerX - (deltaX / props.zoom),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">852</strong>                    centerY: props.centerY + (deltaY / props.zoom),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">853</strong>                });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">854</strong>            });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">855</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">856</strong>            this._lastClientX = clientX;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">857</strong>            this._lastClientY = clientY;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">858</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">859</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">860</strong></pre></div>
<div class="line"><div class="doc"><p>Re-draw the entire graph, including all the grid lines and coordinate numbers.</p>
</div><pre class="source javascript"><strong class="lineNumber">862</strong>    redraw() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">863</strong>        const graphPropsSummary = this.graphProps.summarize();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">864</strong>        const width = this.canvas.width = window.innerWidth;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">865</strong>        const height = this.canvas.height = window.innerHeight;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">866</strong></pre></div>
<div class="line"><div class="doc"><p>Shorthand so I don&#39;t have to keep typing <code>this.context</code></p>
</div><pre class="source javascript"><strong class="lineNumber">868</strong>        const ctx = this.context;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">869</strong></pre></div>
<div class="line"><div class="doc"><p>Clear canvas</p>
</div><pre class="source javascript"><strong class="lineNumber">871</strong>        ctx.clearRect(0, 0, width, height);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">872</strong></pre></div>
<div class="line"><div class="doc"><p>Destructure properties that matter from the graph settings</p>
</div><pre class="source javascript"><strong class="lineNumber">874</strong>        const {centerX, centerY, zoom} = graphPropsSummary;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">875</strong>        const centerXScreen = width / 2;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">876</strong>        const centerYScreen = height / 2;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">877</strong>        const minX = ~~(centerX - (centerXScreen / zoom)) - 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">878</strong>        const maxX = ~~(centerX + (centerXScreen / zoom)) + 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">879</strong>        const minY = ~~(centerY - (centerYScreen / zoom)) - 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">880</strong>        const maxY = ~~(centerY + (centerYScreen / zoom)) + 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">881</strong></pre></div>
<div class="line"><div class="doc"><p>Much of this is same as above, in <code>FunctionGraph</code>&#39;s rendering code.</p>
</div><pre class="source javascript"><strong class="lineNumber">883</strong>        const xToCoord = xValue =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">884</strong>            return centerXScreen + ((xValue - centerX) * zoom);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">885</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">886</strong>        const yToCoord = yValue =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">887</strong>            return centerYScreen - ((yValue - centerY) * zoom);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">888</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">889</strong></pre></div>
<div class="line"><div class="doc"><p>Draw the horizontal grid lines</p>
</div><pre class="source javascript"><strong class="lineNumber">891</strong>        ctx.strokeStyle = '#aaa'; // dark grey</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">892</strong>        ctx.beginPath();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">893</strong>        for (let y = minY; y &#60; maxY; y ++) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">894</strong>            ctx.moveTo(xToCoord(minX), yToCoord(y));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">895</strong>            ctx.lineTo(xToCoord(maxX), yToCoord(y));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">896</strong>        }</pre></div>
<div class="line"><div class="doc"><p>Draw the vertical grid lines</p>
</div><pre class="source javascript"><strong class="lineNumber">898</strong>        for (let x = minX; x &#60; maxX; x ++) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">899</strong>            ctx.moveTo(xToCoord(x), yToCoord(minY));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">900</strong>            ctx.lineTo(xToCoord(x), yToCoord(maxY));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">901</strong>        }</pre></div>
<div class="line"><div class="doc"><p>Commit the lines to the canvas</p>
</div><pre class="source javascript"><strong class="lineNumber">903</strong>        ctx.stroke();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">904</strong></pre></div>
<div class="line"><div class="doc"><p>Draw the zero axes, a bit bolder and thicker than the others.</p>
</div><pre class="source javascript"><strong class="lineNumber">906</strong>        ctx.lineWidth = 3;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">907</strong>        ctx.strokeStyle = '#333';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">908</strong>        ctx.beginPath();</pre></div>
<div class="line"><div class="doc"><p>The y = 0 line</p>
</div><pre class="source javascript"><strong class="lineNumber">910</strong>        ctx.moveTo(xToCoord(minX), yToCoord(0));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">911</strong>        ctx.lineTo(xToCoord(maxX), yToCoord(0));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">912</strong>        // The x = 0 line</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">913</strong>        ctx.moveTo(xToCoord(0), yToCoord(minY));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">914</strong>        ctx.lineTo(xToCoord(0), yToCoord(maxY));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">915</strong>        ctx.stroke();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">916</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">917</strong>        ctx.lineWidth = 2;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">918</strong></pre></div>
<div class="line"><div class="doc"><p>We mark some key coordinates on the graph to orient the user.</p>
</div><pre class="source javascript"><strong class="lineNumber">920</strong>        ctx.font = '16px sans-serif';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">921</strong>        ctx.fillStyle = '#555';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">922</strong>        const markCoord = (x, y) =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">923</strong>            ctx.fillText(`(${x}, ${y})`, xToCoord(x) + 5, yToCoord(y) + 18);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">924</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">925</strong>        markCoord(0, 0);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">926</strong>        markCoord(1, 0);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">927</strong>        markCoord(0, 1);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">928</strong>        markCoord(10, 0);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">929</strong>        markCoord(0, 10);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">930</strong>        markCoord(-10, 0);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">931</strong>        markCoord(0, -10);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">932</strong>        markCoord(50, 0);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">933</strong>        markCoord(0, 50);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">934</strong>        markCoord(-50, 0);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">935</strong>        markCoord(0, -50);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">936</strong></pre></div>
<div class="line"><div class="doc"><p>Since this redraw method is called when the window is resized, for example,
we want to tell each graph to also re-render.</p>
</div><pre class="source javascript"><strong class="lineNumber">939</strong>        for (const graph of this.functionGraphs.components) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">940</strong>            graph.redraw();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">941</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">942</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">943</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">944</strong>    compose() {</pre></div>
<div class="line"><div class="doc"><p>Bind all the drag-and-drop listeners to the parent container
of all the canvas (graph) elements.</p>
</div><pre class="source javascript"><strong class="lineNumber">947</strong>        return jdom`&#60;div id="graphContainer"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">948</strong>            onwheel="${this.handleWheel}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">949</strong>            onmousedown="${this.handleMousedown}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">950</strong>            onmouseup="${this.handleMouseup}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">951</strong>            onmousemove="${this.handleMousemove}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">952</strong>            ontouchstart="${this.handleTouchstart}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">953</strong>            ontouchend="${this.handleTouchend}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">954</strong>            ontouchmove="${this.handleTouchmove}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">955</strong>            ${this.canvas}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">956</strong>            ${this.functionGraphs.node}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">957</strong>        &#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">958</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">959</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">960</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">961</strong></pre></div>
<div class="line"><div class="doc"><p>The app&#39;s root component, also holds all global data.</p>
</div><pre class="source javascript"><strong class="lineNumber">963</strong>class App extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">964</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">965</strong>    init() {</pre></div>
<div class="line"><div class="doc"><p>Create our main collection of functions</p>
</div><pre class="source javascript"><strong class="lineNumber">967</strong>        this.functionStore = new FunctionStore([</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Default, example functions</p>
</div><pre class="source javascript"><strong class="lineNumber">969</strong>            new FunctionRecord({text: 'x + 1'}),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">970</strong>            new FunctionRecord({text: 'x * x'}),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">971</strong>            new FunctionRecord({text: 'sqrt(x)'}),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">972</strong>            new FunctionRecord({text: '1 / x'}),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">973</strong>            new FunctionRecord({text: '2.71828 ^ x * sin(5 * x) / 20'}),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">974</strong>        ]);</pre></div>
<div class="line"><div class="doc"><p>Create a record to keep graph settings, and sync updates
across the UI.</p>
</div><pre class="source javascript"><strong class="lineNumber">977</strong>        this.graphProps = new GraphPropsRecord();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Create nested components: the sidebar overlay, and the graph</p>
</div><pre class="source javascript"><strong class="lineNumber">979</strong>        this.appBar = new AppBar(this.functionStore, this.graphProps);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">980</strong>        this.graph = new Graph(this.functionStore, this.graphProps);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">981</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">982</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">983</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">984</strong>        return {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">985</strong>            'font-family': '-apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">986</strong>            'footer': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">987</strong>                'position': 'fixed',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">988</strong>                'right': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">989</strong>                'bottom': '0',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">990</strong>                'padding': '6px 8px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">991</strong>                'color': '#333',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">992</strong>                'opacity': '.5',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">993</strong>                'font-size': '14px',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">994</strong>                'cursor': 'pointer',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">995</strong>                'transition': 'opacity .2s',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">996</strong>                'a': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">997</strong>                    'color': '#333',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">998</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">999</strong>                '&#38;:hover': {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1000</strong>                    'opacity': '.8',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1001</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1002</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1003</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1004</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1005</strong></pre></div>
<div class="line"><div class="doc"><p>The app itself is pretty simple: the overlay in an overlay container,
and the graph below it.</p>
</div><pre class="source javascript"><strong class="lineNumber">1008</strong>    compose() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1009</strong>        return jdom`&#60;main&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1010</strong>            &#60;div class="overlay"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1011</strong>                ${this.appBar.node}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1012</strong>            &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1013</strong>            ${this.graph.node}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1014</strong>            &#60;footer&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1015</strong>                Built with</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1016</strong>                &#60;a href="https://linus.zone/torus" target="_blank" rel="noopener"&#62;Torus&#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1017</strong>                by &#60;a href="https://linus.zone/now" target="_blank" rel="noopener"&#62;Linus&#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1018</strong>            &#60;/footer&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1019</strong>        &#60;/main&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1020</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1021</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1022</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1023</strong></pre></div>
<div class="line"><div class="doc"><p>Create an instance of the app and mount it to the page DOM.</p>
</div><pre class="source javascript"><strong class="lineNumber">1025</strong>const app = new App();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1026</strong>document.body.appendChild(app.node);</pre></div>
<div class="line"><div class="doc"><p>I like it when the page background isn&#39;t completely white. This is an off-white
shade of very light grey;</p>
</div><pre class="source javascript"><strong class="lineNumber">1029</strong>document.body.style.backgroundColor = '#fbfbfb';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1030</strong></pre></div>
    </main>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github-gist.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>
        for (const el of document.querySelectorAll('.line pre')) {
            hljs.highlightBlock(el);
        }
    </script>
</body>

</html>
